<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compass Heading</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #headingValue {
            font-size: 3em;
            font-weight: bold;
            color: #2c3e50;
            margin: 20px 0;
        }
        #status {
            color: #7f8c8d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>Compass Heading</h1>
    <div id="headingValue">--°</div>
    <div id="status">Waiting for sensor...</div>
    
    <script>
        const headingElement = document.getElementById('headingValue');
        const statusElement = document.getElementById('status');
        
        function updateHeading() {
            try {
                if (window.Magnetometer) {
                    let sensor = new Magnetometer({ frequency: 10 });
                    
                    sensor.addEventListener('reading', () => {
                        // Calculate heading in degrees (0-360)
                        let heading = Math.atan2(sensor.y, sensor.x) * (180 / Math.PI);
                        if (heading < 0) heading += 360; // Convert to 0-360 range
                        
                        headingElement.textContent = Math.round(heading) + '°';
                        statusElement.textContent = "Sensor active";
                    });
                    
                    sensor.addEventListener('error', event => {
                        statusElement.textContent = "Error: " + event.error.name;
                    });
                    
                    sensor.start();
                } else {
                    statusElement.textContent = "Magnetometer not supported in this browser/device";
                }
            } catch (error) {
                statusElement.textContent = "Error: " + error.message;
            }
        }
        
        // Start when page loads
        window.addEventListener('DOMContentLoaded', updateHeading);
    </script>
</body>
</html>